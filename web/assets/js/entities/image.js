// Generated by CoffeeScript 1.10.0
(function() {
  app.module('Entities', function(Entities, app, Backbone, Marionette, $, _) {
    var API, fetchImages;
    Entities.Image = Backbone.Model.extend({
      urlRoot: 'albums'
    });
    Entities.ImageCollection = Backbone.Collection.extend({
      url: 'albums/:id',
      model: Entities.Image,
      parse: function(response) {
        this.album = response.album;
        this.pagination = response.paginationData;
        return response.images.items;
      }
    });
    fetchImages = function(params) {
      var albumId, defer, images, page, url;
      albumId = params.albumId;
      page = params.page;
      images = new Entities.ImageCollection;
      url = 'albums/' + albumId;
      if (page) {
        url += '?page=' + page;
      }
      images.url = url;
      defer = $.Deferred();
      images.fetch({
        success: function(data) {
          defer.resolve(data);
        }
      });
      return defer;
    };
    API = {
      getImageEntities: function(albumId) {
        return fetchImages(albumId);
      }
    };
    app.reqres.setHandler('image:entities', function(params) {
      return API.getImageEntities(params);
    });
  });

}).call(this);
